<!-- START BREADCRUMB -->
<ul class="breadcrumb">
    <li><a href="#">Admin</a></li>
    <li class="active">Simulation</li>
</ul>
<!-- END BREADCRUMB -->
<div class="page-title">
    <h2>Simulation</h2><br>
    <!-- <div ng-repeat="gdp in economy track by gdp.control">
                                                            <a href="#" ng-click="showEconomy(gdp)">{{ gdp }}</a>
    </div> -->
</div>
<div class="page-content-wrap">
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">GDP History</h3>
                </div>
                <div class="panel-body">
                    <div id="container" style="height: 400px"></div>
                    <div id="drag"></div>
                    <div id="drop"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Dynamic Highcharts</h3>
            </div>
            <div class="panel-body">
                <highchart id="chart1" config="chartConfig" class="span9" ></highchart>
                <p>chartData: {{ chartData }}</p>
                <p>Drop: {{ drop }}</p>
                <p>Round: {{ drag }}</p>
                <p>Serie Name: {{ serieName }}</p>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Inputs</h3>
            </div>
            <div class="panel-body">
                <p>change: {{ changed }} </p>
                <p>economy: {{ economy }} </p>
                <div ng-repeat="gdp in economy">
                  <p>GDP: {{ gdp }}</p>
                  <input ng-model="gdp.control" type="text" id="{{ gdp.name }}" size="200">
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var controlData = [0, 1.9, 1.4, 2.2, 3.0, 2.9, 1.6, 0.5]
    var changeValue = function(category, y) {
        var codes = ['nl', 'ge', 'uk']
        var rnd = Number(category.slice(6)) - 1;
        var volitility = 1.83
        for (i=1;i<=codes.length;i++) {
        var random = Math.random();
        var diviation = y + random;
        var formula = diviation * volitility
        // console.log('codes: ', codes[i-1], ' rnd:', rnd, 'category: ', category, ' formula: ', formula);
        // console.log('#' + codes[i-1] + '-round' + (rnd + 1));
        $('#' + codes[i-1] + '-round' + (rnd + 1)).val(formula);
        chart.series[i].data[rnd].update(formula);
        };
    };
    var updateEconomy = function (serieName, round, y) {
        // $.getJSON( "api/economy", function(data) {
        //   console.log('data: ', data);
        // });
        var rnd = Number(round.slice(6));
        var $serieId = $('#' + serieName)
        var gdpInput = $serieId.val();
        var gdpObj = gdpInput.split(',');
        for (i=0;i<gdpObj.length;i++) {
          gdpObj[i] = Number(gdpObj[i])
        }
        // console.log('gdpArr: ', gdpArr);
        // var gdpObj = JSON.parse(gdpArr);
        // var serie = gdpObj.control;
        // console.log('Old gdpObj: ', gdpObj)
        // var hello = JSON.parse(gdpObj)
        // console.log('Old gdpObj parsed: ', hello)
        if (gdpObj.indexOf(gdpObj[rnd -1]) !== undefined) {
          var index = gdpObj.indexOf(gdpObj[rnd - 1])
          console.log('gdpObj[index]: ', gdpObj[index])
          console.log('y: ', y)
          gdpObj[index] = y
          console.log('New gdpObj: ', gdpObj)
          $serieId.val(gdpObj)
          $serieId.trigger('input');
        }        
        // if (index !== -1) {
        //     serie[index] = y;
        //     for (key in gdpObj) {
        //       if (key == 'control') {
        //         gdpObj[key] = serie
        //       }
        //     }
        //     $serieId.val(JSON.stringify(gdpObj))
        // }


    };
    var chart = new Highcharts.Chart({
        chart: {
            renderTo: 'container',
            animation: false
        },
            colors: ['#7cb5ec', '#90ed7d', '#f7a35c', '#8085e9', '#f15c80', '#e4d354', '#8085e8', '#8d4653', '#91e8e1'],
        title: {
            text: 'West-Europe GDP Development'
        },
        xAxis: {
            categories: ['Round 1', 'Round 2', 'Round 3', 'Round 4', 'Round 5', 'Round 6', 'Round 7', 'Round 8']
        },
        plotOptions: {
            column: {
                stacking: 'normal'
            },
            line: {
                cursor: 'ns-resize'
            }
        },
        tooltip: {
            yDecimals: 2
        },
        credits: {
        enabled: false
        },
        series: [{
            name: 'Control',
            color: 'grey',
            data: controlData,
            draggableY: true,
            marker: {
                radius: 6
            },
            point: {
                events: {
                    drag: function (e) {
                        // Returning false stops the drag and drops. Example:
                        /*
                        if (e.newY > 300) {
                            this.y = 300;
                            return false;
                        }
                        */
                        $('#drag').html(
                            'Dragging <b>' + this.series.name + '</b>, <b>' + this.category + '</b> to <b>' + Highcharts.numberFormat(e.newY, 2) + '</b>');
                    },
                    drop: function () {
                        $('#drop').html(
                            'In <b>' + this.series.name + '</b>, <b>' + this.category + '</b> was set to <b>' + Highcharts.numberFormat(this.y, 2) + '</b>');
                        changeValue(this.category, this.y);
                        updateEconomy(this.series.name, this.category, this.y);
                    }
                }
            },
            stickyTracking: false
        },{
            name: 'The Netherlands',
            data: [0.4, 1.2, 1.5, 2.7, 2.8, 3.1, 0.9, -0.9],
            draggableY: false,
            type: 'spline',
            lineWidth: '3px',
            states: {
                hover: {
                    enabled: false
                }
            },
            marker: {
                enabled: false,
                states: {
                    hover: {
                        enabled: false,
                        lineWidthPlus: '1px'
                    },
                    select: {
                        enabled: false
                    }
                }
            }
        }, {
            name: 'Germany',
            data: [0.6, 1.4, 1.7, 2.9, 3.0, 3.3, 1.2, -0.7],
            draggableY: false,
            type: 'spline',
            lineWidth: '3px',
            states: {
            hover: {
                enabled: false
            }
            },
            marker: {
            enabled: false,
            states: {
                hover: {
                enabled: false,
                lineWidthPlus: '1px'
                }
            }
            }
        }, {
            name: 'United Kingdom',
            data: [0.2, 1.0, 1.3, 2.5, 2.6, 2.9, 0.7, -1.1],
            draggableY: false,
            type: 'spline',
            lineWidth: '3px',
            states: {
            hover: {
                enabled: false
            }
            },
            marker: {
            enabled: false,
            states: {
                hover: {
                enabled: false,
                lineWidthPlus: '1px'
                }
            }
            }
        }]
    });
</script>